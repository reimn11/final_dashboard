---
title: "final_dashboard"
author: "Rei Miyashiro"
format: 
  dashboard:
    orientation: rows
---

```{r}
library(tidyverse)
library(readr)
library(plotly)
library(scales)

sleep <- read_csv("data/Sleep_health_and_lifestyle_dataset.csv")
```

# Page 1

## Row 1

```{r}
# Make a long version with both sleep measures AND Sleep Disorder
sleep_long <- sleep |>
  select(`Stress Level`, `Sleep Duration`, `Quality of Sleep`, `Sleep Disorder`) |>
  pivot_longer(
    cols = c(`Sleep Duration`, `Quality of Sleep`),
    names_to = "sleep_measure",
    values_to = "value"
  )

sleep_long |>
  ggplot(aes(x = `Stress Level`,
             y = value,
             color = `Sleep Disorder`)) +  # map color to the column
  geom_jitter(width = 0.1, alpha = 0.5) +
  geom_smooth(method = 'lm', se = FALSE) +
  facet_wrap(~ sleep_measure, scales = "free_y") +
  labs(
    title = "Stress level vs sleep duration and quality, colored by sleep disorder",
    x = "Stress level (higher = more stress)",
    y = "Value",
    color = "Sleep disorder"
  ) +
  theme_minimal()

```

```{r}

# 1. Count BMI categories within each sleep disorder
bmi_sleep_counts <- sleep |>
  count(`Sleep Disorder`, `BMI Category`) |>
  group_by(`Sleep Disorder`) |>
  mutate(
    prop  = n / sum(n),
    label = percent(prop, accuracy = 0.1)
  )
# 2. Pie charts: one per sleep disorder
bmi_sleep_counts |>
  ggplot(aes(x = "", y = prop, fill = `BMI Category`)) +
  geom_col(color = "white", width = 1) +      # stacked bar
  coord_polar(theta = "y") +                  # turn bar into pie
  facet_wrap(~ `Sleep Disorder`) +            # one pie per disorder
  labs(
    title = "BMI Category distribution within each sleep disorder",
    x = NULL,
    y = NULL,
    fill = "BMI Category"
  ) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank()
  )

```

## Row 2

```{r}
# Split Blood Pressure into numeric columns
sleep_bp <- sleep |>
  separate(
    `Blood Pressure`,
    into = c("Systolic", "Diastolic"),
    sep = "/",
    convert = TRUE   # makes them numeric
  )

sleep_bp |>
  ggplot(aes(x = Systolic,
             y = `Sleep Duration`,
             color = `BMI Category`)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = 'lm',se = FALSE) +
  labs(
    title = "Sleep Duration vs. Systoric blood pressure by BMI category",
    x = "Systoric blood pressure",
    y = "SLEEP DURATION",
    color = "BMI Category"
  ) +
  theme_minimal()

```

```{r}
sleep_bp |>
  ggplot(aes(x = Diastolic,
             y = `Sleep Duration`,
             color = `BMI Category`)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = 'lm',se = FALSE) +
  labs(
    title = "Sleep Duration vs. Diastolic blood pressure by BMI category",
    x = "Diastolic blood pressure",
    y = "SLEEP DURATION",
    color = "BMI Category"
  ) +
  theme_minimal()
```

```{r}
### Sleep Disorder, Stress ###


sleep |>
  ggplot(aes(x = `Sleep Disorder`,
             y = `Stress Level`,
             fill = `Sleep Disorder`)) +
  geom_violin(alpha = 0.7) +
  labs(
    title = "Stress level across BMI categories",
    x = "Sleep Disorder",
    y = "Stress Level"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 20, hjust = 1),
    legend.position = "none"
  )
```

![]()

# Page 2

## Row 1

```{r}
### Relationship Physical Activity and Sleep duration and quality ###

sleep_pa_long <- sleep %>% 
  select(`Physical Activity Level`, `Sleep Duration`, `Quality of Sleep`) |>
  pivot_longer(
    cols = c(`Sleep Duration`, `Quality of Sleep`),
    names_to = "sleep_measure",
    values_to = "value"
  )

sleep_pa_long %>% 
  ggplot(aes(x = `Physical Activity Level`, y = value)) +
  geom_jitter(width = 0.1, alpha = 0.5, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE, color = "darkred") +
  facet_wrap(~ sleep_measure, scales = "free_y") +
  labs(
    title = "Relationship between Pysical Activity level and sleep duration/quality",
    x = "Physical Activity Level",
    y = "Value"
  ) +
  theme_minimal()


```

```{r}
### Physical activity good for BMI? ###

sleep_pa_bmi <- sleep |>
  mutate(
    PA_cat = case_when(
      `Physical Activity Level` < 30 ~ "Low (<30)",
      `Physical Activity Level` < 60 ~ "Medium (30â€“59)",
      TRUE ~ "High (70+)"
    )
  ) |>
  filter(!is.na(PA_cat), !is.na(`BMI Category`))


sleep_pa_bmi |>
  ggplot(aes(x = `BMI Category`,
             y = `Physical Activity Level`,
             fill = `BMI Category`)) +
  geom_violin() +
  labs(
    title = "Physical activity level by BMI category",
    x = "BMI Category",
    y = "Physical Activity Level (minutes / score)"
  ) +
  theme_minimal()
```

## Row 2

```{r}
### Stress, BMI ###


sleep_bp |>
  ggplot(aes(x = `Physical Activity Level`,
             y = `Stress Level`,
             color = `BMI Category`)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = 'lm',se = FALSE) +
  labs(
    title = "Sleep Duration vs. Stress Level by BMI category",
    x = "Pysical Activity",
    y = "Stress",
    color = "BMI Category"
  ) +
  theme_minimal()
```

for the people with nomal BMI doesn't improve the sterss level by physical activity but for the peoplr with overweight and obese can be improve the stress level by high pysisical activity rate. Stress stongly conect to sleep duration/quality, so it can improve the sleep for them.

```{r}
### Pysical Activity, Streess by Sleep disorder### 


sleep_bp |>
  ggplot(aes(x = `Physical Activity Level`,
             y = `Stress Level`,
             color = `Sleep Disorder`)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = 'lm',se = FALSE) +
  labs(
    title = "Physical Activity Lelevel vs. Stress Level by Sleep Disorder",
    x = "Physical Activity Lelevel",
    y = "Stress Level",
    color = "Sleep Disorder"
  ) +
  theme_minimal()
```
