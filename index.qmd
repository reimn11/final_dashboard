---
format: 
  dashboard:
    orientation: rows
---

```{r}
library(tidyverse)
library(readr)
library(plotly)
library(scales)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)

sleep <- read_csv("data/Sleep_health_and_lifestyle_dataset.csv")
```

# Page 1

## Row 1

```{r}

sleep_long <- sleep %>%
  select(`Stress Level`, `Sleep Duration`, `Quality of Sleep`, `Sleep Disorder`) %>%
  pivot_longer(
    cols = c(`Sleep Duration`, `Quality of Sleep`),
    names_to  = "sleep_measure",
    values_to = "value"
  )

# Build the ggplot
p_stress_sleep <- sleep_long %>%
  ggplot(aes(x = `Stress Level`,
             y = value,
             color = `Sleep Disorder`)) +
  geom_jitter(width = 0.1, alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ sleep_measure, scales = "free_y") +
  scale_color_manual(
    values = c(
      "Sleep Apnea" = "purple4",  
      "Insomnia"    = "firebrick4",  
      "None"        = "palegreen2"   
    )
  ) +
  labs(
    title  = "Stress level vs sleep duration and quality, colored by sleep disorder",
    x      = "Stress level (higher = more stress)",
    y      = "Value",
    color  = "Sleep disorder"
  ) +
  theme_minimal()

# Convert to interactive Plotly
ggplotly(p_stress_sleep)

```

```{r}
library(scales)
# Clean BMI Category labels in the original data
sleep_clean <- sleep %>%
  mutate(
    `BMI Category` = recode(
      `BMI Category`,
      "Normal Weight" = "Normal"   # combine into one category
    )
  )

# Count BMI categories within each sleep disorder (using cleaned data)
bmi_sleep_counts <- sleep_clean %>%
  count(`Sleep Disorder`, `BMI Category`) %>%
  group_by(`Sleep Disorder`) %>%
  mutate(
    prop  = n / sum(n),
    label = percent(prop, accuracy = 0.1)
  )

# Pie charts: one per sleep disorder
bmi_sleep_counts %>%
  ggplot(aes(x = "", y = prop, fill = `BMI Category`)) +
  geom_col(color = "white", width = 1) +
  coord_polar(theta = "y") +
  facet_wrap(~ `Sleep Disorder`) +
  scale_fill_manual(
    values = c(
      "Obese" = "lightsalmon",  
      "Overweight"    = "firebrick1",  
      "Normal"        = "palegreen2"   
    )
  ) +
  labs(
    title = "BMI Category distribution within each sleep disorder",
    x = NULL,
    y = NULL,
    fill = "BMI Category"
  ) +
  theme_minimal() +
  theme(
    axis.text  = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank()
  )
```

## Row 2

```{r}
### Sleep Disorder, Stress ###
sleep_clean %>% 
  ggplot(aes(x = `BMI Category`,
             y = `Stress Level`,
             fill = `BMI Category`)) +
  geom_violin() +
  scale_fill_manual(
    values = c(
      "Obese" = "lightsalmon",  
      "Overweight"    = "firebrick1",  
      "Normal"        = "palegreen2"   
    )
  ) +
  labs(
    title = "Stress level across BMI categories",
    x = "BMI Category",
    y = "Stress Level"
  ) +
  theme_minimal() 
```

# Page 2

## Row 1

```{r}
### Relationship Physical Activity and Sleep duration and quality ###

sleep_pa_long <- sleep %>% 
  select(`Physical Activity Level`, `Sleep Duration`, `Quality of Sleep`) %>% 
  pivot_longer(
    cols = c(`Sleep Duration`, `Quality of Sleep`),
    names_to = "sleep_measure",
    values_to = "value"
  )

sleep_pa_long %>% 
  ggplot(aes(x = `Physical Activity Level`, y = value)) +
  geom_jitter(width = 0.1, alpha = 0.5, color = "gold2") +
  geom_smooth(method = "lm", se = FALSE, color = "azure4") +
  facet_wrap(~ sleep_measure, scales = "free_y") +
  labs(
    title = "Relationship between Pysical Activity level and sleep duration/quality",
    x = "Physical Activity Level",
    y = "Value"
  ) +
  theme_minimal()


```

```{r}
### Physical activity good for BMI? ###

sleep_clean  %>% 
  ggplot(aes(x = `BMI Category`,
             y = `Physical Activity Level`,
             fill = `BMI Category`)) +
  geom_violin(color = NA) +
  geom_boxplot(width = 0.15, outlier.alpha = 0, fill = "white") +
  scale_fill_manual(
    values = c(
      "Obese" = "lightsalmon",  
      "Overweight"    = "firebrick1",  
      "Normal"        = "palegreen2"   
    )
  ) +
  labs(
    title = "Physical activity level by BMI category",
    x = "BMI Category",
    y = "Physical Activity Level"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

```

## Row 2

```{r}
### Stress, BMI ###

sleep_clean %>% 
  ggplot(aes(x = `Physical Activity Level`,
             y = `Stress Level`,
             color = `BMI Category`)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = 'loess',se = FALSE) +
  scale_color_manual(
    values = c(
      "Obese" = "lightsalmon",  
      "Overweight"    = "firebrick1",  
      "Normal"        = "palegreen2"  
    )
  ) +
  labs(
    title = "Sleep Duration vs. Stress Level by BMI category",
    x = "Pysical Activity",
    y = "Stress",
    color = "BMI Category"
  ) +
  theme_minimal()
```
